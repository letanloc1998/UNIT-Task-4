<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="en">

<head></head>

<body>

    <th:block th:fragment="index-footer">
        <!--Index  -->

        <script th:src="@{/static/index-template/plugins/greensock/TweenMax.min.js}"></script>
        <script th:src="@{/static/index-template/plugins/greensock/TimelineMax.min.js}"></script>
        <script th:src="@{/static/index-template/plugins/scrollmagic/ScrollMagic.min.js}"></script>
        <script th:src="@{/static/index-template/plugins/greensock/animation.gsap.min.js}"></script>
        <script th:src="@{/static/index-template/plugins/greensock/ScrollToPlugin.min.js}"></script>
        <script th:src="@{/static/index-template/plugins/OwlCarousel2-2.2.1/owl.carousel.js}"></script>
        <script th:src="@{/static/index-template/plugins/slick-1.8.0/slick.js}"></script>
        <script th:src="@{/static/index-template/plugins/easing/easing.js}"></script>
        <script th:src="@{/static/index-template/js/custom.js}"></script>
        <!--         <script th:src="@{/static/index-template/js/product_custom.js}"></script> -->


        <!--  Notifications Plugin    -->
        <script th:src="@{/static/admin/js/core/bootstrap-material-design.min.js}"></script>

        <script th:src="@{/static/admin/js/plugins/perfect-scrollbar.jquery.min.js}"></script>
        <script th:src="@{/static/admin/js/plugins/bootstrap-notify.js}"></script>
        <!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
        <script th:src="@{/static/admin/js/material-dashboard.js?v=2.1.2}" type="text/javascript"></script>

        <script th:inline="javascript">


            const searchForm = document.querySelector("#search-form");
            const searchFormInput = searchForm.querySelector("input");


            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

            if (SpeechRecognition) {
                console.log("Support");
                searchForm.insertAdjacentHTML("beforeend", '<button id="searchBtn" type="button" class="header_search_button trans_300"><i class=" fas fa-microphone"></i></button>')
                const micBtn = searchForm.querySelector("button");
                const micIcon = micBtn.querySelector("i");

                const recognition = new SpeechRecognition();
                //recognition.continuous = true;

                micBtn.addEventListener("click", micBtnClick);

                recognition.addEventListener("start", startSpeechRecognition);
                recognition.addEventListener("end", endSpeechRecognition);
                recognition.addEventListener("result", resultOfSpeechRecognition);

                // recognition.addEventListener("start", startSpeechRecognition);
                function startSpeechRecognition() {
                    micIcon.classList.remove("fa-microphone");
                    micIcon.classList.add("fa-microphone-slash");
                    console.log("Speech Recognition Active " + Date.now());
                    searchFormInput.focus();
                }
                // recognition.addEventListener("end",endSpeechRecognition);
                function endSpeechRecognition() {
                    micIcon.classList.remove("fa-microphone-slash");
                    micIcon.classList.add("fa-microphone");
                    console.log("Speech Recognition DeActive")
                }

                // recognition.addEventListener("result", resultOfSpeechRecognition);
                function resultOfSpeechRecognition(event) {
                    const transcript = event.results[0][0].transcript;
                    searchFormInput.value = transcript;
                    setTimeout(() => {
                        searchForm.submit();
                    }, 750);
                }

                function micBtnClick() {
                    if (micIcon.classList.contains("fa-microphone")) {
                        recognition.start();
                    } else {
                        recognition.stop();
                    }


                }
            } else {
                console.log("No support")
            }














            let home = [[@{/}]];

            const list_cart_item = [[${ cartitems }]];
            const count_cart_item = [[${ total_cart_item }]];
            console.log(list_cart_item);
            console.log(count_cart_item);



            if (home.slice(home.length - 1) == "/") {
                home = home.slice(0, -1);
            }


            //search ajax
            $(document).ready(function () {
                $("#result-items").hide()
                $("#searchBox").keyup(
                    function searchProduct() {
                        var key = $("#searchBox").val()
                        var data_search = ""
                        console.log(key)
                        var token = $("meta[name='_csrf']").attr("content");
                        var header = $("meta[name='_csrf_header']").attr("content");
                        data = `${key}`;
                        $.ajax({
                            url: `/search-ajax`,
                            type: 'POST',

                            dataType: "json",
                            contentType: "application/json",

                            // data: JSON.stringify(`{"product_id" : ${product_id}}`),
                            data: data,
                            // data: JSON.stringify(data),

                            beforeSend: function (xhr) {
                                xhr.setRequestHeader(header, token);
                            },

                            success: function (data, status, xhr) {
                                //md.showAddProductNoti('bottom','right',data.msg)
                                console.log(data)
                                $("#result-items").show()
                                //  

                                var i = 0
                                if (data.length > 5) {
                                    for (i; i < 5; i++) {
                                        data_search += "<div id=\"result-item\" onclick=\"window.location=\'" + home + "/product/" + data[i].id + "'\" class=\"row\">"
                                            + "<div class=\"col-sm-3\" >"
                                            + "<img class=\"img-search\" src=\"" + data[i].img + "\">"
                                            + "</div>"
                                            + "<div class=\"col-sm-6\">"
                                            + "<h3 style=\"color: black\">" + data[i].name + "</h3>"
                                            + "</div>"
                                            + "<div class=\"col-sm-3\">"
                                            + "<h3 style=\"color:red\">$" + data[i].price + "</h3>"
                                            + "</div>"
                                            + "</div>"
                                    }
                                } else {
                                    for (i; i < data.length; i++) {
                                        data_search += "<div id=\"result-item\" onclick=\"window.location=\'" + home + "/product/" + data[i].id + "'\" class=\"row\">"
                                            + "<div class=\"col-sm-3\" >"
                                            + "<img class=\"img-search\" src=\"" + data[i].img + "\">"
                                            + "</div>"
                                            + "<div class=\"col-sm-6\">"
                                            + "<h3 style=\"color: black\">" + data[i].name + "</h3>"
                                            + "</div>"
                                            + "<div class=\"col-sm-3\">"
                                            + "<h3 style=\"color:red\">$" + data[i].price + "</h3>"
                                            + "</div>"
                                            + "</div>"
                                    }
                                }
								/* 
								data.forEach(function(item){
									data_search += "<input class=\"header_search_input\" value=\""+item.name+"\" /> <br>"
								}) */
                                console.log(data_search)
                                $("#result-items").html(data_search)
                            },
                            error: function (request, status, error) {
                                console.log("NO key")
                                $("#result-items").hide()
                                //window.location.href = window.location.href;
                            }
                        });






                    }

                );

            });


































            function addCart(product_id) {
                if (!e) var e = window.event;
                e.cancelBubble = true;
                if (e.stopPropagation) e.stopPropagation();

                console.log(product_id)

                let token = $("meta[name='_csrf']").attr("content");
                let header = $("meta[name='_csrf_header']").attr("content");
                // let data = new Object();
                // data.product_id = product_id;
                let data = `{"product_id" : ${product_id}}`;
                // console.log(data);

                try {
                    let quantity = $('#quantity_input').val();
                    if (typeof quantity === 'undefined') {

                    }
                    else {
                        data = `{"product_id" : ${product_id},"quantity" : ${quantity}}`;
                    }
                } catch (error) {

                }

                $.ajax({
                    url: `${home}/cart/add`,
                    type: 'PUT',

                    dataType: "json",
                    contentType: "application/json",

                    // data: JSON.stringify(`{"product_id" : ${product_id}}`),
                    data: data,
                    // data: JSON.stringify(data),

                    beforeSend: function (xhr) {
                        xhr.setRequestHeader(header, token);
                    },

                    success: function (data, status, xhr) {
                        md.showAddProductNoti('bottom', 'right', data.msg)
                        $('#count').text(data.total_item)
                        $('#total').text(data.total)
                        //   window.location.href = window.location.href;
                    },
                    error: function (request, status, error) {

                        try {
                            if (request.status == 405) {
                                window.location.href = `${home}/login`;
                            }
                            // console.log(request.status);
                            // console.log(status);
                            // console.log(error);
                            // window.location.href = `${home}/login`;
                        } catch (error) { }
                    }
                });

            }


        </script>

        <!--   <script th:inline="javascript">
	        document.querySelector(".super_container").style.height = "1000px";
	
	        window.addEventListener("scroll", function() {
	            var body = document.querySelector(".super_container");
	            var height = body.style.height;
	            height = height.slice(0, -2);
	            height = Number(height);
	            return function() {
	                if(height - window.scrollY < 700) {
	                    height += height / 2;
	                }
	                body.style.height = height + "px";	                
	            };
	        }() ); 
	       
        </script>-->

    </th:block>

</body>

</html>