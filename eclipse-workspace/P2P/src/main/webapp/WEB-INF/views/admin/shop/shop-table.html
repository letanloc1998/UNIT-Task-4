<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="en">

<head>
<th:block th:include="admin/layout/head :: head"></th:block>

</head>

<body>
	<div class="wrapper ">

		<div th:replace="admin/layout/leftNavAdmin :: leftNavAdmin"></div>

		<div class="main-panel">
			<!-- Navbar -->
			<div th:replace="admin/layout/HeadNavAdmin :: headNavAdmin"></div>
			<!-- End Navbar -->
			<!-- content -->
			<div th:replace="components/admin/shop/shop-table :: shop-table"></div>
			<!-- End content -->
			<div th:replace="admin/layout/footerAdmin :: footerAdmin"></div>
		</div>
	</div>
	<th:block th:replace="admin/layout/footer :: footer"></th:block>

	<script th:inline="javascript">
        var shops = [[${ pageable.data }]]; 
          function DeleteShop(i,mode) {
        	 /* const shops = [[${ pageable.data }]]; */
				
        	console.log(shops[i].id)
                var token = $("meta[name='_csrf']").attr("content");
                var header = $("meta[name='_csrf_header']").attr("content");
                Swal.fire({
                	  title: 'Are you sure?',
                	  text: "You won't be able to revert this!",
                	  icon: 'warning',
                	  showCancelButton: true,
                	  confirmButtonColor: '#3085d6',
                	  cancelButtonColor: '#d33',
                	  confirmButtonText: 'Yes, delete it!'
                	}).then((result) => {
                		
                	  if (result.value) {
                         	    	 $.ajax({
                                         url: `/admin/shop/delete/${shops[i].id}`,
                                         type: 'DELETE',
                                         beforeSend: function (xhr) {
                                             xhr.setRequestHeader(header, token);
                                         },
                                         success: function (data, status, xhr) {
                                             // alert(status);
                                             // To reload the page discarding the POST data(perform a GET request)
											Swal.fire({
					                    		  position: 'center',
					                    		  icon: 'success',
					                    		  title: 'Delete Success',
					                    		  showConfirmButton: false,
					                    		  timer: 800
						                    		}).then(()=>{
						                    			Pagging([[${ pageable.limit }]],[[${ pageable.page }]],mode)

						                                
						                    		})                                         
						                    		},
                                         error: function (request, status, error) {
                                             alert(status,request,error);
                                             // To reload the page discarding the POST data(perform a GET request)
                                             window.location.href = window.location.href;
                                         }
                                     });
                	  }
                	})
                	
          
            }
        
        function Pagging(limit,page,mode){
       	 var token = $("meta[name='_csrf']").attr("content");
            var header = $("meta[name='_csrf_header']").attr("content");
    		var keyword = $("#search-box").val();
    		if(!mode && mode!=0){
    			mode = [[${ mode }]]
    		}
	console.log(limit,page,mode)
            $.ajax({
               url: `/admin/shop/ajax-list?page=${page}&limit=${limit}&mode=${mode}`,
               type: 'GET', 		
               beforeSend: function (xhr) {
                   xhr.setRequestHeader(header, token);
               },
   
               success: function (data, status, xhr) {
            	 	/* console.log(data) */
             	  	var data = data.replace('<body', '<body><div id="body"').replace('</body>','</div></body>');
                   var body = $(data).filter('#body');
                   var idTable = $(data).find("#shop-list-table").length;
                   if(idTable > 0){
                 	 /*  $("#shop-list-table").html(body); */
                 	 console.log(body.html());
                 	  document.getElementById("shop-list-table").innerHTML = body.html();
                   }else{
                 	  window.location.href = "/login"
                   }   
               },
               error: function (request, status, error) {
              /*     
                   // To reload the page discarding the POST data(perform a GET request)
                   window.location.href = window.location.href; */
                   
             	  alert(request.status);
               }
           });  
    	}
        
        function acceptShop(i,mode) {
            /* const shops = [[${ pageable.data }]] */
                var token = $("meta[name='_csrf']").attr("content");
                var header = $("meta[name='_csrf_header']").attr("content");
                console.log(mode)
                $.ajax({
                    url: `/admin/shop/accept/${shops[i].id}`,
                    type: 'PUT',
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader(header, token);
                    },
                    success: function (data, status, xhr) {
                    	Swal.fire({
                    		  position: 'center',
                    		  icon: 'success',
                    		  title: 'Active Success',
                    		  showConfirmButton: false,
                    		  timer: 800
                    		}).then(()=>{
                    			Pagging([[${ pageable.limit }]],[[${ pageable.page }]],mode)
 
                    		})
                    },
                    error: function (request, status, error) {
                        alert(status);
                        window.location.href = window.location.href;
                    }
                });
            
              
            }
      </script>
</body>
</html>